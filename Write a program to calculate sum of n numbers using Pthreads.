#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>

#define MAX 100
int arr[MAX];
int total_sum = 0;
int n, num_threads;

pthread_mutex_t lock;

void* compute_sum(void* arg) {
    int thread_id = *(int*)arg;
    int start = thread_id * (n / num_threads);
    int end = (thread_id == num_threads - 1) ? n : start + (n / num_threads);

    int partial_sum = 0;
    for (int i = start; i < end; i++) {
        partial_sum += arr[i];
    }

    pthread_mutex_lock(&lock);
    total_sum += partial_sum;
    pthread_mutex_unlock(&lock);

    pthread_exit(NULL);
}

int main() {
    printf("Enter number of elements (max %d): ", MAX);
    scanf("%d", &n);
    if (n > MAX) {
        printf("Too many elements. Limit is %d.\n", MAX);
        return 1;
    }

    printf("Enter %d elements:\n", n);
    for (int i = 0; i < n; i++) {
        scanf("%d", &arr[i]);
    }

    printf("Enter number of threads: ");
    scanf("%d", &num_threads);
    if (num_threads <= 0 || num_threads > n) {
        printf("Invalid number of threads.\n");
        return 1;
    }

    pthread_t threads[num_threads];
    int thread_ids[num_threads];
    pthread_mutex_init(&lock, NULL);

    for (int i = 0; i < num_threads; i++) {
        thread_ids[i] = i;
        pthread_create(&threads[i], NULL, compute_sum, &thread_ids[i]);
    }

    for (int i = 0; i < num_threads; i++) {
        pthread_join(threads[i], NULL);
    }

    pthread_mutex_destroy(&lock);

    printf("Total sum of array = %d\n", total_sum);
    return 0;
}
